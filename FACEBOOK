--CREATE DATABASE red_social;
USE red_social;

--Agregaci칩n de usuarios 
CREATE TABLE usuarios (
    id_usuario INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL,
    apellido VARCHAR(50),
    correo VARCHAR(100) UNIQUE NOT NULL,
    contrase침a VARCHAR(255) NOT NULL,
    fecha_registro DATETIME DEFAULT CURRENT_TIMESTAMP,
    foto_perfil VARCHAR(255),
    INDEX (correo)
);

--Table de publicaciones 
CREATE TABLE publicaciones (
    id_publicacion INT AUTO_INCREMENT PRIMARY KEY,
    id_usuario INT NOT NULL,
    contenido TEXT NOT NULL,
    imagen VARCHAR(255),
    fecha_publicacion DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario)
);

DELIMITER $$
--registrar un nuevo usuario 
CREATE PROCEDURE registrar_usuario (
    IN p_nombre VARCHAR(50),
    IN p_apellido VARCHAR(50),
    IN p_correo VARCHAR(100),
    IN p_contrase침a VARCHAR(255),
    IN p_foto_perfil VARCHAR(255)
)
BEGIN
    INSERT INTO usuarios (nombre, apellido, correo, contrase침a, foto_perfil)
    VALUES (p_nombre, p_apellido, p_correo, p_contrase침a, p_foto_perfil);
END$$

DELIMITER ;

CALL registrar_usuario('Carlos', 'Ramos', 'carlos@example.com', '12345', 'perfil1.jpg');

--inicia sessi칩n para validar usuario 
DELIMITER $$

CREATE PROCEDURE iniciar_sesion (
    IN p_correo VARCHAR(100),
    IN p_contrase침a VARCHAR(255)
)
BEGIN
    SELECT id_usuario, nombre, apellido
    FROM usuarios
    WHERE correo = p_correo AND contrase침a = p_contrase침a;
END$$

DELIMITER ;

CALL iniciar_sesion('carlos@example.com', '12345');


--creamos publicaci칩n 
DELIMITER $$

CREATE PROCEDURE iniciar_sesion (
    IN p_correo VARCHAR(100),
    IN p_contrase침a VARCHAR(255)
)
BEGIN
    SELECT id_usuario, nombre, apellido
    FROM usuarios
    WHERE correo = p_correo AND contrase침a = p_contrase침a;
END$$

DELIMITER ;

CALL crear_publicacion(1, 'Hoy fue un gran d칤a aprendiendo SQL 游땙', 'foto_dia.jpg');


--ver todas las publicaciones 
DELIMITER $$

CREATE PROCEDURE ver_feed ()
BEGIN
    SELECT 
        u.nombre AS usuario,
        u.apellido,
        p.contenido,
        p.fecha_publicacion
    FROM publicaciones p
    INNER JOIN usuarios u ON p.id_usuario = u.id_usuario
    ORDER BY p.fecha_publicacion DESC;
END$$

DELIMITER ;

CALL ver_feed();

-- Insertar 1000 usuarios autom치ticamente
DELIMITER $$

CREATE PROCEDURE generar_usuarios(IN cantidad INT)
BEGIN
    DECLARE i INT DEFAULT 1;
    WHILE i <= cantidad DO
        INSERT INTO usuarios (nombre, apellido, correo, contrase침a, foto_perfil)
        VALUES (
            CONCAT('Usuario', i),
            CONCAT('Apellido', i),
            CONCAT('usuario', i, '@example.com'),
            'pass123',
            CONCAT('perfil', i, '.jpg')
        );
        SET i = i + 1;
    END WHILE;
END$$

DELIMITER ;

--SE Ejecuta de acuerdo a la cantidad de usuarios 
CALL generar_usuarios(1000);

-- Ver cantidad total de usuarios
SELECT COUNT(*) AS total_usuarios FROM usuarios;

-- Ver las 칰ltimas publicaciones con autor
CALL ver_feed();
